<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Starbug</title><link href="https://holrock.github.io/" rel="alternate"></link><link href="https://holrock.github.io/feeds/ocaml.atom.xml" rel="self"></link><id>https://holrock.github.io/</id><updated>2017-06-25T00:00:00+09:00</updated><entry><title>CVE-2017-9772の脆弱性</title><link href="https://holrock.github.io/cve-2017-9772nocui-ruo-xing.html" rel="alternate"></link><published>2017-06-25T00:00:00+09:00</published><updated>2017-06-25T00:00:00+09:00</updated><author><name>horlock</name></author><id>tag:holrock.github.io,2017-06-25:cve-2017-9772nocui-ruo-xing.html</id><summary type="html">&lt;p&gt;OCaml4.04.0,4.04.1にローカル権限昇格の脆弱性があったので4.04.2が出てます。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://caml.inria.fr/mantis/view.php?id=7557"&gt;0007557: local privilege escalation issue with ocaml binaries&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;影響を受けるのは以下の状況ですが、かなり限定的だと思います。詳しくは上のmantisの方に再現手順があります。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ocamlコンパイラで生成され、setuid, setgidされた実行ファイルが実行される際に&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CAML_CPLUGINS, CAML_NATIVE_CPLUGINS, CAML_BYTE_CPLUGINS&lt;/code&gt;環境変数に共有ライブラリへのパスを設定された場合&lt;/li&gt;
&lt;li&gt;共有ライブラリ内でのsetreuidによって権限昇格が可能になる&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;注入される共有ライブラリは既存のランタイム内hookが利用可能で、
この件とは直接関係ありませんが外部から注入可にしては能な強力すぎるように見えます。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cm"&gt;/* Load dynamic plugins indicated in the CAML_CPLUGINS environment&lt;/span&gt;
&lt;span class="cm"&gt;   variable. These plugins can be used to set currently existing&lt;/span&gt;
&lt;span class="cm"&gt;   hooks, such as GC hooks and system calls tracing (see misc.h).&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;脆弱性が埋め込まれた経緯は、&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;4.04.0からocamlランタイムに&lt;code&gt;CAML_CPLUGINS&lt;/code&gt;環境変数に設定された共有ライブラリを自動でロードする機能が追加されたが(&lt;a href="https://github.com/ocaml/ocaml/pull/668"&gt;プルリク&lt;/a&gt;)、
ドキュメント化されずデフォルトで有効な状態だった。&lt;/li&gt;
&lt;li&gt;環境変数の読み込み時に、&lt;a href="https://linuxjm.osdn.jp/html/LDP_man-pages/man3/getenv.3.html"&gt;secure_getenv&lt;/a&gt;のようなset-user-IDチェックが存在しなかったため、
素通ししてしまった。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;対策として、&lt;code&gt;secure_getenv&lt;/code&gt;がある場合は使用して、なければ自前でチェックするようにしたようです。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Sys.getenv&lt;/code&gt;と&lt;code&gt;Unix.getenv&lt;/code&gt;も変更の影響を受けるので、以前の動作が欲しい場合は&lt;code&gt;Sys.unsafe_getenv&lt;/code&gt; が使用できます。&lt;/p&gt;
&lt;p&gt;また、ocamlコンパイラ自体のビルド時に&lt;code&gt;-no-cplugins&lt;/code&gt;フラグを指定するとこの機能自体を無効化できます。
対策でuidはチェックされるようになりましたが、
実行時に環境変数に指定されたファイルが自動ロードされてランタイムを変更できてしまう、
というのはどうも筋が良くない気がします。無効化しておいたほうが無難な印象です。&lt;/p&gt;</summary><category term="ocaml"></category></entry><entry><title>OCaml 4.04.1</title><link href="https://holrock.github.io/ocaml-4041.html" rel="alternate"></link><published>2017-04-16T00:00:00+09:00</published><updated>2017-04-16T00:00:00+09:00</updated><author><name>horlock</name></author><id>tag:holrock.github.io,2017-04-16:ocaml-4041.html</id><summary type="html">&lt;p&gt;OCaml 4.04.1が出ました。
&lt;a href="https://caml.inria.fr/pub/distrib/ocaml-4.04/notes/Changes"&gt;Changes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/ocaml/ocaml/pull/894"&gt;Set.mapのバグ&lt;/a&gt;も修正されているので
インストールしようと思いましたが、&lt;code&gt;opam update&lt;/code&gt;しても&lt;code&gt;opam switch list&lt;/code&gt;に出てきません。&lt;/p&gt;
&lt;p&gt;redditでも&lt;a href="https://www.reddit.com/r/ocaml/comments/65bnx5/ocaml_4041_released_dedicated_to_the_memory_of/dg9bach/"&gt;話題&lt;/a&gt;
になっています。
&lt;a href="https://github.com/ocaml/opam-repository/pull/8968"&gt;merge&lt;/a&gt;したから&lt;code&gt;opam update&lt;/code&gt;した？というコメントもありますが、
実際のところ、&lt;code&gt;opam update&lt;/code&gt;が参照しているhttps://opam.ocaml.org/urls.txtに変更が書かれていないため、リストに出てこないようです。&lt;/p&gt;
&lt;p&gt;そうこうしているうちにhomebrewの方に4.04.1が来てたので&lt;code&gt;opam switch system&lt;/code&gt;で済ませてしまいました。&lt;/p&gt;</summary><category term="ocaml"></category></entry><entry><title>Biocaml SAM header</title><link href="https://holrock.github.io/biocaml-sam-header.html" rel="alternate"></link><published>2017-02-21T00:00:00+09:00</published><updated>2017-02-21T00:00:00+09:00</updated><author><name>horlock</name></author><id>tag:holrock.github.io,2017-02-21:biocaml-sam-header.html</id><summary type="html">&lt;p&gt;ocaml製のバイオインフォマティクス用ライブラリで、
&lt;a href="http://biocaml.org"&gt;biocaml&lt;/a&gt;というのがあります。&lt;/p&gt;
&lt;p&gt;BAMファイルを読みたかったので使ってみましたが、
&lt;code&gt;@HG&lt;/code&gt;ヘッダーにある&lt;code&gt;GO&lt;/code&gt;(group order)に未対応で読めなかったため、
ちょっと修正しました。&lt;/p&gt;
&lt;p&gt;opamで落ちてくる0.6.0用です。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;utop&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;biocaml.unix&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;;&lt;/span&gt;
&lt;span class="n"&gt;utop&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="k"&gt;open&lt;/span&gt; &lt;span class="nn"&gt;Biocaml_unix&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;Std&lt;/span&gt;&lt;span class="o"&gt;;;&lt;/span&gt;
&lt;span class="n"&gt;utop&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="nn"&gt;Bam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;open_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;a.bam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);;&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nn"&gt;Bam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Header&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nn"&gt;Sam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alignment&lt;/span&gt; &lt;span class="nn"&gt;Core_kernel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Std&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Or_error&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="nn"&gt;Stream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nn"&gt;Core_kernel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Result_wrapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;Error&lt;/span&gt;
 &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;unexpected tag for given header item type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;HD&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;GO&lt;/span&gt;&lt;span class="o"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gh"&gt;diff --git a/lib/unix/sam.ml b/lib/unix/sam.ml&lt;/span&gt;
&lt;span class="gh"&gt;index 9bd17ac..2da7b75 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/lib/unix/sam.ml&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/lib/unix/sam.ml&lt;/span&gt;
&lt;span class="gu"&gt;@@ -26,9 +26,13 @@ type tag_value = string * string&lt;/span&gt;
 type sort_order = [ `Unknown | `Unsorted | `Query_name | `Coordinate ]
 [@@deriving sexp]

&lt;span class="gi"&gt;+type group_order = [ `None | `Query | `Reference ]&lt;/span&gt;
&lt;span class="gi"&gt;+[@@deriving sexp]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 type header_line = {
   version : string;
   sort_order : sort_order option;
&lt;span class="gi"&gt;+  group_order: group_order option;&lt;/span&gt;
 } [@@deriving sexp]

 type ref_seq = {
&lt;span class="gu"&gt;@@ -81,6 +85,7 @@ type header_item = [&lt;/span&gt;
 type header = {
   version : string option;
   sort_order : sort_order option;
&lt;span class="gi"&gt;+  group_order : group_order option;&lt;/span&gt;
   ref_seqs : ref_seq list;
   read_groups : read_group list;
   programs : program list;
&lt;span class="gu"&gt;@@ -91,6 +96,7 @@ type header = {&lt;/span&gt;
 let empty_header = {
   version = None;
   sort_order = None;
&lt;span class="gi"&gt;+  group_order = None;&lt;/span&gt;
   ref_seqs = [];
   read_groups = [];
   programs = [];
&lt;span class="gu"&gt;@@ -192,9 +198,9 @@ let parse_header_version s =&lt;/span&gt;
     else
       err

&lt;span class="gd"&gt;-let header_line ~version ?sort_order () =&lt;/span&gt;
&lt;span class="gi"&gt;+let header_line ~version ?sort_order ?group_order () =&lt;/span&gt;
   parse_header_version version &amp;gt;&amp;gt;| fun version -&amp;gt;
&lt;span class="gd"&gt;-  {version; sort_order}&lt;/span&gt;
&lt;span class="gi"&gt;+  {version; sort_order; group_order}&lt;/span&gt;

 let ref_seq
     ~name ~length
&lt;span class="gu"&gt;@@ -269,7 +275,7 @@ let read_group&lt;/span&gt;


 let header
&lt;span class="gd"&gt;-    ?version ?sort_order ?(ref_seqs=[]) ?(read_groups=[])&lt;/span&gt;
&lt;span class="gi"&gt;+    ?version ?sort_order ?group_order ?(ref_seqs=[]) ?(read_groups=[])&lt;/span&gt;
     ?(programs=[]) ?(comments=[]) ?(others=[])
     ()
     =
&lt;span class="gu"&gt;@@ -302,7 +308,7 @@ let header&lt;/span&gt;
   |&amp;gt; List.filter_map ~f:Fn.id
   |&amp;gt; function
      | [] -&amp;gt; Ok {
&lt;span class="gd"&gt;-       version; sort_order; ref_seqs; read_groups;&lt;/span&gt;
&lt;span class="gi"&gt;+       version; sort_order; group_order; ref_seqs; read_groups;&lt;/span&gt;
        programs; comments; others;
      }
      | errs -&amp;gt; Error (Error.of_list errs)
&lt;span class="gu"&gt;@@ -407,12 +413,20 @@ let parse_sort_order = function&lt;/span&gt;
   | &amp;quot;coordinate&amp;quot; -&amp;gt; Ok `Coordinate
   | x -&amp;gt; error &amp;quot;invalid sort order&amp;quot; x sexp_of_string

&lt;span class="gi"&gt;+let parse_group_order = function&lt;/span&gt;
&lt;span class="gi"&gt;+  | &amp;quot;none&amp;quot; -&amp;gt; Ok `None&lt;/span&gt;
&lt;span class="gi"&gt;+  | &amp;quot;query&amp;quot; -&amp;gt; Ok `Query&lt;/span&gt;
&lt;span class="gi"&gt;+  | &amp;quot;reference&amp;quot; -&amp;gt; Ok `Reference&lt;/span&gt;
&lt;span class="gi"&gt;+  | x -&amp;gt; error &amp;quot;invalid group order&amp;quot; x sexp_of_string&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 let parse_header_line tvl =
   find1 `HD tvl &amp;quot;VN&amp;quot; &amp;gt;&amp;gt;= fun version -&amp;gt;
   find01 `HD tvl &amp;quot;SO&amp;quot; &amp;gt;&amp;gt;?~
   parse_sort_order &amp;gt;&amp;gt;= fun sort_order -&amp;gt;
&lt;span class="gd"&gt;-  assert_tags `HD tvl [&amp;quot;VN&amp;quot;; &amp;quot;SO&amp;quot;] &amp;gt;&amp;gt;= fun () -&amp;gt;&lt;/span&gt;
&lt;span class="gd"&gt;-  header_line ~version ?sort_order ()&lt;/span&gt;
&lt;span class="gi"&gt;+  find01 `HD tvl &amp;quot;GO&amp;quot; &amp;gt;&amp;gt;?~&lt;/span&gt;
&lt;span class="gi"&gt;+  parse_group_order &amp;gt;&amp;gt;= fun group_order -&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+  assert_tags `HD tvl [&amp;quot;VN&amp;quot;; &amp;quot;SO&amp;quot;; &amp;quot;GO&amp;quot;] &amp;gt;&amp;gt;= fun () -&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+  header_line ~version ?sort_order ?group_order ()&lt;/span&gt;

 let parse_ref_seq tvl =
   find1 `SQ tvl &amp;quot;SN&amp;quot; &amp;gt;&amp;gt;= fun name -&amp;gt;
&lt;span class="gu"&gt;@@ -844,13 +858,25 @@ let print_sort_order x =&lt;/span&gt;
     | `Coordinate -&amp;gt; &amp;quot;coordinate&amp;quot;
     )

&lt;span class="gd"&gt;-let print_header_line ({version; sort_order} : header_line) =&lt;/span&gt;
&lt;span class="gd"&gt;-  sprintf &amp;quot;@HD\tVN:%s%s&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+let print_group_order x =&lt;/span&gt;
&lt;span class="gi"&gt;+  print_tag_value&amp;#39; &amp;quot;GO&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+    (match x with&lt;/span&gt;
&lt;span class="gi"&gt;+    | `None -&amp;gt; &amp;quot;none&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+    | `Query -&amp;gt; &amp;quot;query&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+    | `Reference -&amp;gt; &amp;quot;reference&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
&lt;span class="gi"&gt;+let print_header_line ({version; sort_order; group_order} : header_line) =&lt;/span&gt;
&lt;span class="gi"&gt;+  sprintf &amp;quot;@HD\tVN:%s%s%s&amp;quot;&lt;/span&gt;
     version
     (match sort_order with
     | None -&amp;gt; &amp;quot;&amp;quot;
     | Some x -&amp;gt; sprintf &amp;quot;\t%s&amp;quot; (print_sort_order x)
     )
&lt;span class="gi"&gt;+    (match group_order with&lt;/span&gt;
&lt;span class="gi"&gt;+    | None -&amp;gt; &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+    | Some x -&amp;gt; sprintf &amp;quot;\t%s&amp;quot; (print_group_order x)&lt;/span&gt;
&lt;span class="gi"&gt;+    )&lt;/span&gt;

 let print_ref_seq (x:ref_seq) =
   sprintf &amp;quot;@SQ\tSN:%s\tLN:%d%s%s%s%s&amp;quot;
&lt;span class="gu"&gt;@@ -1011,12 +1037,12 @@ module MakeIO(Future : Future.S) = struct&lt;/span&gt;
           Pipe.junk lines &amp;gt;&amp;gt;= fun () -&amp;gt;
           parse_header_item line |&amp;gt; function
           | Error _ as e -&amp;gt; return e
&lt;span class="gd"&gt;-          | Ok (`HD ({version; sort_order} : header_line)) -&amp;gt; (&lt;/span&gt;
&lt;span class="gi"&gt;+          | Ok (`HD ({version; sort_order; group_order} : header_line)) -&amp;gt; (&lt;/span&gt;
             match hdr.version with
             | Some _ -&amp;gt;
               return (Or_error.error_string &amp;quot;multiple @HD lines not allowed&amp;quot;)
             | None -&amp;gt;
&lt;span class="gd"&gt;-              loop {hdr with version = Some version; sort_order}&lt;/span&gt;
&lt;span class="gi"&gt;+              loop {hdr with version = Some version; sort_order; group_order}&lt;/span&gt;
           )
           | Ok (`SQ x) -&amp;gt; loop {hdr with ref_seqs = x::hdr.ref_seqs}
           | Ok (`RG x) -&amp;gt; loop {hdr with read_groups = x::hdr.read_groups}
&lt;span class="gu"&gt;@@ -1028,14 +1054,14 @@ module MakeIO(Future : Future.S) = struct&lt;/span&gt;
     in
     loop empty_header &amp;gt;&amp;gt;| function
     | Error _ as e -&amp;gt; e
&lt;span class="gd"&gt;-    | Ok ({version; sort_order; _} as x) -&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    | Ok ({version; sort_order; group_order; _} as x) -&amp;gt;&lt;/span&gt;
       let ref_seqs = List.rev x.ref_seqs in
       let read_groups = List.rev x.read_groups in
       let programs = List.rev x.programs in
       let comments = List.rev x.comments in
       let others = List.rev x.others in
       header
&lt;span class="gd"&gt;-        ?version ?sort_order ~ref_seqs ~read_groups&lt;/span&gt;
&lt;span class="gi"&gt;+        ?version ?sort_order ?group_order ~ref_seqs ~read_groups&lt;/span&gt;
         ~programs ~comments ~others ()


&lt;span class="gu"&gt;@@ -1064,7 +1090,7 @@ module MakeIO(Future : Future.S) = struct&lt;/span&gt;
     (match h.version with
     | None -&amp;gt; Deferred.unit
     | Some version -&amp;gt;
&lt;span class="gd"&gt;-      write_line w (print_header_line {version; sort_order=h.sort_order})&lt;/span&gt;
&lt;span class="gi"&gt;+      write_line w (print_header_line {version; sort_order=h.sort_order; group_order=h.group_order})&lt;/span&gt;
     ) &amp;gt;&amp;gt;= fun () -&amp;gt;
     Deferred.List.iter h.ref_seqs ~f:(fun x -&amp;gt;
       write_line w (print_ref_seq x)
&lt;span class="gh"&gt;diff --git a/lib/unix/sam.mli b/lib/unix/sam.mli&lt;/span&gt;
&lt;span class="gh"&gt;index 1fbf606..ff4da2a 100644&lt;/span&gt;
&lt;span class="gd"&gt;--- a/lib/unix/sam.mli&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/lib/unix/sam.mli&lt;/span&gt;
&lt;span class="gu"&gt;@@ -28,6 +28,9 @@ type tag_value = private string * string&lt;/span&gt;
 type sort_order = [ `Unknown | `Unsorted | `Query_name | `Coordinate ]
 [@@deriving sexp]

&lt;span class="gi"&gt;+type group_order = [ `None | `Query | `Reference ]&lt;/span&gt;
&lt;span class="gi"&gt;+[@@deriving sexp]&lt;/span&gt;
&lt;span class="gi"&gt;+&lt;/span&gt;
 (** @HD. A header consists of different types of lines. Confusingly, one of
     these types is called {i the} &amp;quot;header line&amp;quot;, which is what this
     type refers to. It does not refer generically to any line within a
&lt;span class="gu"&gt;@@ -35,6 +38,7 @@ type sort_order = [ `Unknown | `Unsorted | `Query_name | `Coordinate ]&lt;/span&gt;
 type header_line = private {
   version : string; (** VN *)
   sort_order : sort_order option; (** SO *)
&lt;span class="gi"&gt;+  group_order: group_order option; (** GO *)&lt;/span&gt;
 } [@@deriving sexp]

 (** @SQ. Reference sequence. *)
&lt;span class="gu"&gt;@@ -103,6 +107,7 @@ type header_item = private [&amp;lt;&lt;/span&gt;
 type header = private {
   version : string option;
   sort_order : sort_order option;
&lt;span class="gi"&gt;+  group_order : group_order option;&lt;/span&gt;
   ref_seqs : ref_seq list;
   read_groups : read_group list;
   programs : program list;
&lt;span class="gu"&gt;@@ -229,6 +234,7 @@ include module type of MakeIO(Future_unix)&lt;/span&gt;
 val header_line
   :  version:string
   -&amp;gt; ?sort_order:sort_order
&lt;span class="gi"&gt;+  -&amp;gt; ?group_order:group_order&lt;/span&gt;
   -&amp;gt; unit
   -&amp;gt; header_line Or_error.t

&lt;span class="gu"&gt;@@ -264,6 +270,7 @@ val read_group&lt;/span&gt;
 val header
    : ?version:string
   -&amp;gt; ?sort_order:sort_order
&lt;span class="gi"&gt;+  -&amp;gt; ?group_order:group_order&lt;/span&gt;
   -&amp;gt; ?ref_seqs : ref_seq list
   -&amp;gt; ?read_groups : read_group list
   -&amp;gt; ?programs : program list
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;utop&lt;/span&gt; &lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="nn"&gt;Bam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;open_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;a.bam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);;&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nn"&gt;Bam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Header&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nn"&gt;Sam&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alignment&lt;/span&gt; &lt;span class="nn"&gt;Core_kernel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Std&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Or_error&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="nn"&gt;Stream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nn"&gt;Core_kernel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Std&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Or_error&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;                                                                                                                                                                  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nn"&gt;Core_kernel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Result_wrapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nn"&gt;Result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;Ok&lt;/span&gt; &lt;span class="o"&gt;(&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;abstr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;abstr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;masterブランチはビルド失敗するし、ドキュメントとも乖離が激しいので
積極的にメンテナンスはされていないようですね。&lt;/p&gt;
&lt;p&gt;追記。プルリクエスト取り込んでもらいました。&lt;/p&gt;</summary><category term="ocaml"></category></entry><entry><title>macOS 10.12.1にあげたらlibcryptoが見つからない</title><link href="https://holrock.github.io/macos-10121niagetaralibcryptogajian-tsukaranai.html" rel="alternate"></link><published>2016-11-02T00:00:00+09:00</published><updated>2016-11-02T00:00:00+09:00</updated><author><name>horlock</name></author><id>tag:holrock.github.io,2016-11-02:macos-10121niagetaralibcryptogajian-tsukaranai.html</id><summary type="html">&lt;p&gt;macOSをSierraにあげました。&lt;/p&gt;
&lt;p&gt;その後xcode8.1のインストールをして、omacのビルドをするとlibcryptoが見つからずエラーになりました。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;% ocaml setup.ml -build &lt;/span&gt;
&lt;span class="n"&gt;Finished&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;targets&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;cached&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;00.&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Users&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;hoge&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;opam&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;4.03&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ocamlfind&lt;/span&gt; &lt;span class="n"&gt;ocamlopt&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;linkpkg&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;cohttp&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;cohttp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lwt&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;conduit&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;cryptokit&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;lwt&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;omac&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cmx&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cmx&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;native&lt;/span&gt;
&lt;span class="n"&gt;ld&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;library&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;lcrypto&lt;/span&gt;
&lt;span class="n"&gt;clang&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;linker&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt; &lt;span class="n"&gt;failed&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;exit&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;use&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;invocation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;File&lt;/span&gt; &amp;quot;&lt;span class="n"&gt;caml_startup&lt;/span&gt;&amp;quot;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="n"&gt;during&lt;/span&gt; &lt;span class="n"&gt;linking&lt;/span&gt;
&lt;span class="n"&gt;Command&lt;/span&gt; &lt;span class="n"&gt;exited&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="mf"&gt;2.&lt;/span&gt;
&lt;span class="n"&gt;Compilation&lt;/span&gt; &lt;span class="n"&gt;unsuccessful&lt;/span&gt; &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="n"&gt;building&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="n"&gt;targets&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="n"&gt;cached&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;01.&lt;/span&gt;
&lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Failure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&amp;quot;&lt;span class="n"&gt;Command&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Users&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;hoge&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;opam&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;4.03&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ocamlbuild&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;native&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;test_main&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;native&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt; &lt;span class="n"&gt;tests&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;terminated&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&amp;quot;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;***&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;homebrewで入れてるのでclangにパスを渡すため、LIBRARY_PATH環境変数に値を入れます。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;% export LIBRARY_PATH=$HOME/homebrew/Cellar/openssl/1.0.2j/lib&lt;/span&gt;
&lt;span class="c"&gt;% ocaml setup.ml -build &lt;/span&gt;
&lt;span class="n"&gt;Finished&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;targets&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;cached&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;00.&lt;/span&gt;
&lt;span class="n"&gt;Finished&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt; &lt;span class="n"&gt;targets&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="n"&gt;cached&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;01.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;これでビルドできるようになりました。&lt;/p&gt;
&lt;p&gt;あれ？てことはいままでsystem側のlibにリンクしてたんだろうか。&lt;/p&gt;</summary><category term="ocaml"></category></entry><entry><title>conduit with homebrew openssl</title><link href="https://holrock.github.io/conduit-with-homebrew-openssl.html" rel="alternate"></link><published>2016-10-28T00:00:00+09:00</published><updated>2016-10-28T00:00:00+09:00</updated><author><name>horlock</name></author><id>tag:holrock.github.io,2016-10-28:conduit-with-homebrew-openssl.html</id><summary type="html">&lt;h1&gt;現象&lt;/h1&gt;
&lt;p&gt;cohttpでhttpsから&lt;code&gt;Client.get&lt;/code&gt;すると
&lt;code&gt;(Failure "No SSL or TLS support compiled into Conduit")&lt;/code&gt;
とエラーになった&lt;/p&gt;
&lt;h1&gt;対策&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;CPPFLAGS=&amp;quot;-I&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/homebrew/opt/openssl/include&amp;quot; opam install ssl&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;原因&lt;/h1&gt;
&lt;p&gt;homebrewでopensslを入れており、homebrewのpathを/usr/localから$HOME/homebrewに変えていたため、
opamでsslをビルドできなかった。&lt;/p&gt;</summary><category term="ocaml"></category></entry></feed>